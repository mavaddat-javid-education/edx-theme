<%page expression_filter="h"/>
<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>
<%def name="online_help_token()"><% return "progress" %></%def>
<%!
  from course_modes.models import CourseMode
  from certificates.models import CertificateStatuses
  from django.utils.translation import ugettext as _
  from openedx.core.djangolib.markup import HTML, Text
  from django.core.urlresolvers import reverse
  from django.conf import settings
  from django.utils.http import urlquote_plus
%>
<%block name="bodyclass">view-in-course view-progress</%block>

<%block name="headextra">
  <%static:css group='style-course-vendor'/>
  <%static:css group='style-course'/>
</%block>


<%namespace name="progress_graph" file="/courseware/progress_graph.js"/>

<%block name="pagetitle">${_("{course_number} Progress").format(course_number=course.display_number_with_default)}</%block>

<%block name="js_extra">
  <script type="text/javascript" src="${static.url('js/vendor/flot/jquery.flot.js')}"></script>
  <script type="text/javascript" src="${static.url('js/vendor/flot/jquery.flot.stack.js')}"></script>
  <script type="text/javascript" src="${static.url('js/vendor/flot/jquery.flot.symbol.js')}"></script>
  <script type="text/javascript" src="${static.url('js/courseware/certificates_api.js')}"></script>
  <script type="text/javascript" src="${static.url('js/courseware/credit_progress.js')}"></script>
  <script>
    ## This JavaScript is being HTML-escaped because it historically has, and it is not clear what
    ## the correct syntax is. For safety, maintain the previous behavior.
    ## xss-lint: disable=mako-invalid-js-filter
    ${progress_graph.body(grade_summary, course.grade_cutoffs, "grade-detail-graph", not course.no_grade, not course.no_grade)}
</script>
</%block>

<%include file="/courseware/course_navigation.html" args="active_page='progress'" />

<main id="main" aria-label="Content" tabindex="-1">
  <!--theme creation-->
  <div class="progress__main-wrapper">
    %if courseware_summary:
      <div class="progress__score-wrapper">
        <%def name="pointending()">
          %if points_difference%10 == 1:
            балл
          %elif points_difference%10>=2 and points_difference%10<=4:
            балла
          %elif points_difference%10==0 or (points_difference%10>=5 and points_difference%10<=9):
            баллов
          %else:
            баллов
          %endif
        </%def>
        <div class="progress__score-holder">
          <p class="progress__main-progress">Твой прогресс по курсу: <strong>${persentage_current} / 100</strong></p>
          <div class="progress__score-subholder">
            %if assessment_current:
              <p class="progress__score">Оценка: <strong>${assessment_current} из ${assessment_maximum}</strong></p>
            %if assessment_current != assessment_maximum:
              <p class="progress__score-remaining">(необходимо набрать еще ${points_difference} баллов, чтобы
                получить ${assessment_next}
                из ${assessment_maximum})</p>
            %endif
            %else:
              <p class="progress__score">Оценка: <strong>O из ${assessment_maximum}</strong></p>
              <p class="progress__score-remaining">(необходимо набрать еще ${points_difference} ${pointending()} чтобы
                получить ${assessment_minimum}
                из ${assessment_maximum})</p>
            %endif
          </div>
        </div>
      </div>
      <div class="progress__static-text-holder">
        <div class="progress__gradient-line"></div>
        <div class="progress__static-text">Ниже представлена детальная информация по баллам за задания, в % :</div>
      </div>
      <section class="progress__holder">
        %for counter, chapter in enumerate(courseware_summary, start=1):
          %if not chapter['display_name'] == "hidden":
          <%
            a = 'images/progress{}.svg'.format(counter)
          %>
            <div class="progress__item-wrapper">
              <section class="progress__item">
                <div class="progress__image-holder">
                  <img class="progress__image" src="${static.url(a)}" alt="">
                </div>
                <h3 class="progress__title">${ chapter['display_name']}</h3><!--Section Name-->
                <div class="progress__inner-holder">
                  <div class="progress__ol-block">
                    %for section in chapter['sections']:
                    <%
                      earned = section.all_total.earned
                      total = section.all_total.possible
                      percentageString = "{0:.0%}".format(float(earned)/total) if total > 0 else "0%"
                    %>
                    <div class="progress__wrapper">
                    % if not loop.last:
                      <div class="progress__subtitle">
                    % else:
                      <div class="progress__total-result">
                    %endif
                      <h4>${section.display_name}</h4><!--Subsection Name-->
                    </div>
                      <div class="progress__in-wrapper">
                        %if len(section.problem_scores.values()) > 0:
                          <div class="progress__bar-holder">
                            <p class="progress__bar" style="width: ${percentageString}"></p>
                            <p class="progress__number">${percentageString[0:-1]}%</p>
                          </div><!--Subsection Percent-->
                        %else:
                          <div class="progress__bar-holder"><p class="progress__bar" style="width: 0%"></p></div>
                          <!--Section Percent-->
                        %endif
                      </div>
                    </div>
                    %endfor
                  </div>
                  </div>
              </section>
            </div>
          %endif
        %endfor
      </section>
    %endif
  </div>
  <!--end-->
</main>
<%static:require_module_async module_name="js/dateutil_factory" class_name="DateUtilFactory">
  DateUtilFactory.transform(iterationKey=".localized-datetime");
</%static:require_module_async>

